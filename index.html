<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalTranslate - Offline Translation Extension</title>
    <style>
        /* Global Styles */
        :root {
            --primary: #4a6fa5;
            --primary-dark: #3a5a8a;
            --secondary: #f5f7fa;
            --text: #333;
            --text-light: #666;
            --border: #ddd;
            --success: #4caf50;
            --error: #f44336;
            --warning: #ff9800;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --radius: 12px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--secondary);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .container {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            pointer-events: none;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            position: relative;
        }
        
        .subtitle {
            opacity: 0.9;
            font-size: 0.95rem;
            position: relative;
        }
        
        .main-content {
            padding: 25px;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
            color: var(--primary-dark);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            font-size: 1.4rem;
        }
        
        .input-group {
            margin-bottom: 15px;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text-light);
        }
        
        select, textarea, input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }
        
        select:focus, textarea:focus, input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.6;
        }
        
        .char-count {
            position: absolute;
            right: 10px;
            bottom: 10px;
            font-size: 0.8rem;
            color: var(--text-light);
            background: rgba(255, 255, 255, 0.8);
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.secondary {
            background: white;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        button.secondary:hover {
            background: var(--secondary);
        }
        
        button.warning {
            background: white;
            color: var(--warning);
            border: 1px solid var(--warning);
        }
        
        button.warning:hover {
            background: rgba(255, 152, 0, 0.1);
        }
        
        .result-container {
            background: var(--secondary);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            min-height: 100px;
            border: 1px solid var(--border);
            position: relative;
        }
        
        .result-text {
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .language-info {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .dictionary-section {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin-top: 25px;
        }
        
        .dictionary-item {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }
        
        .dictionary-item:hover {
            background: rgba(74, 111, 165, 0.05);
        }
        
        .dictionary-item:last-child {
            border-bottom: none;
        }
        
        .dictionary-item div {
            flex: 1;
        }
        
        .dictionary-item button {
            width: auto;
            padding: 6px 12px;
            margin-left: 10px;
            font-size: 0.85rem;
            margin-top: 0;
        }
        
        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .success {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }
        
        .error {
            background: rgba(244, 67, 54, 0.1);
            color: var(--error);
            border: 1px solid var(--error);
        }
        
        .warning-msg {
            background: rgba(255, 152, 0, 0.1);
            color: var(--warning);
            border: 1px solid var(--warning);
        }
        
        .hidden {
            display: none;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            flex: 1;
            text-align: center;
            transition: all 0.3s;
            background: #f0f4f9;
        }
        
        .tab.active {
            background: var(--primary);
            color: white;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: var(--text-light);
            font-size: 0.85rem;
            border-top: 1px solid var(--border);
            margin-top: 20px;
        }
        
        .lang-flag {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            margin-right: 5px;
        }
        
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .copy-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(74, 111, 165, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .placeholder {
            color: #aaa;
            font-style: italic;
        }
        
        .dictionary-empty {
            text-align: center;
            padding: 20px;
            color: var(--text-light);
        }
        
        .lang-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .lang-option {
            flex: 1;
            text-align: center;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .lang-option.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .lang-option:hover:not(.active) {
            background: var(--secondary);
        }
        
        .history-item {
            padding: 10px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }
        
        .history-item:hover {
            background: var(--secondary);
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-text {
            font-size: 0.9rem;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }
        
        .history-translation {
            font-size: 0.85rem;
            color: var(--text-light);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>LocalTranslate</h1>
            <p class="subtitle">Offline Browser Translation Extension</p>
        </header>
        
        <div class="main-content">
            <div class="tab-container">
                <div class="tab active" data-tab="translate">Translation</div>
                <div class="tab" data-tab="dictionary">Dictionary</div>
                <div class="tab" data-tab="history">History</div>
                <div class="tab" data-tab="settings">Settings</div>
            </div>
            
            <!-- Translation Tab -->
            <div id="translate-tab" class="tab-content active">
                <div class="section">
                    <h2 class="section-title">
                        <span>🌎</span> Text Translation
                    </h2>
                    
                    <div class="input-group">
                        <label for="source-text">Text to translate:</label>
                        <textarea id="source-text" placeholder="Enter text to translate or select text on page and click extension icon..." maxlength="500"></textarea>
                        <div class="char-count">0/500</div>
                    </div>
                    
                    <div class="input-group">
                        <label>Detected Language:</label>
                        <input type="text" id="source-lang" readonly>
                    </div>
                    
                    <div class="input-group">
                        <label>Translate to:</label>
                        <div class="lang-selector">
                            <div class="lang-option active" data-lang="es">
                                <span class="lang-flag">🇪🇸</span> Spanish
                            </div>
                            <div class="lang-option" data-lang="fr">
                                <span class="lang-flag">🇫🇷</span> French
                            </div>
                            <div class="lang-option" data-lang="de">
                                <span class="lang-flag">🇩🇪</span> German
                            </div>
                        </div>
                    </div>
                    
                    <button id="translate-btn">
                        <span>🔍</span> Translate Text
                    </button>
                    
                    <div class="result-container">
                        <div class="result-text" id="translation-result">Translation will appear here...</div>
                        <button class="copy-btn">📋 Copy</button>
                        <div class="language-info">
                            <span>ℹ️</span> <span id="translation-info"></span>
                        </div>
                    </div>
                </div>
                
                <div class="dictionary-section">
                    <h3 class="section-title">
                        <span>📚</span> Dictionary Suggestions
                    </h3>
                    <div id="dictionary-suggestions"></div>
                </div>
            </div>
            
            <!-- Dictionary Tab -->
            <div id="dictionary-tab" class="tab-content">
                <div class="section">
                    <h2 class="section-title">
                        <span>📖</span> Manage Dictionary
                    </h2>
                    
                    <div class="dictionary-section">
                        <div class="input-group">
                            <label for="source-word">Source Word:</label>
                            <input type="text" id="source-word" placeholder="Enter word in source language">
                        </div>
                        
                        <div class="input-group">
                            <label for="target-word">Translated Word:</label>
                            <input type="text" id="target-word" placeholder="Enter translation">
                        </div>
                        
                        <div class="input-group">
                            <label for="dictionary-lang">Language Pair:</label>
                            <select id="dictionary-lang">
                                <option value="en-es">English → Spanish</option>
                                <option value="en-fr">English → French</option>
                                <option value="en-de">English → German</option>
                            </select>
                        </div>
                        
                        <button id="add-word-btn">
                            <span>➕</span> Add to Dictionary
                        </button>
                        
                        <div class="message hidden" id="dictionary-message"></div>
                    </div>
                    
                    <div class="section">
                        <h2 class="section-title">
                            <span>🗃️</span> Your Dictionary Entries
                        </h2>
                        <div id="dictionary-entries">
                            <!-- Dictionary entries will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- History Tab -->
            <div id="history-tab" class="tab-content">
                <div class="section">
                    <h2 class="section-title">
                        <span>🕒</span> Translation History
                    </h2>
                    
                    <div class="input-group">
                        <label>Filter by language:</label>
                        <select id="history-filter">
                            <option value="all">All Languages</option>
                            <option value="en-es">English → Spanish</option>
                            <option value="en-fr">English → French</option>
                            <option value="en-de">English → German</option>
                        </select>
                    </div>
                    
                    <div id="history-list">
                        <!-- History items will be loaded here -->
                    </div>
                    
                    <button id="clear-history" class="warning">
                        <span>🗑️</span> Clear History
                    </button>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-content">
                <div class="section">
                    <h2 class="section-title">
                        <span>⚙️</span> Extension Settings
                    </h2>
                    
                    <div class="input-group">
                        <label for="enable-hotkey">Enable Translation Hotkey (Ctrl+Shift+T)</label>
                        <select id="enable-hotkey">
                            <option value="true">Enabled</option>
                            <option value="false">Disabled</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="default-lang">Default Target Language</label>
                        <select id="default-lang">
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="translation-history">Translation History</label>
                        <select id="translation-history">
                            <option value="10">Last 10 translations</option>
                            <option value="25">Last 25 translations</option>
                            <option value="50">Last 50 translations</option>
                            <option value="0">Disabled</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label>Dictionary Size: <span id="dict-size">0</span> entries</label>
                    </div>
                    
                    <button id="save-settings">
                        <span>💾</span> Save Settings
                    </button>
                    <button id="reset-dictionary" class="secondary">
                        <span>🔄</span> Reset Dictionary
                    </button>
                    <button id="export-data" class="secondary">
                        <span>📤</span> Export Dictionary & Settings
                    </button>
                    <button id="import-data" class="secondary">
                        <span>📥</span> Import Dictionary & Settings
                    </button>
                    
                    <div class="message hidden" id="settings-message"></div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>LocalTranslate v1.0 | Offline Translation Extension | All processing happens locally in your browser</p>
        </footer>
    </div>

    <script>
        // Main Translation Engine
        class TranslationEngine {
            constructor() {
                this.dictionary = {};
                this.settings = {};
                this.history = [];
                this.init();
            }
            
            init() {
                this.loadDictionary();
                this.loadSettings();
                this.loadHistory();
            }
            
            // Load dictionary from localStorage
            loadDictionary() {
                const savedDictionary = localStorage.getItem('translationDictionary');
                if (savedDictionary) {
                    this.dictionary = JSON.parse(savedDictionary);
                } else {
                    // Add some default translations
                    this.dictionary = {
                        'en-es': {
                            'hello': 'hola',
                            'goodbye': 'adiós',
                            'thank you': 'gracias',
                            'please': 'por favor',
                            'yes': 'sí',
                            'no': 'no',
                            'how are you': 'cómo estás',
                            'good morning': 'buenos días'
                        },
                        'en-fr': {
                            'hello': 'bonjour',
                            'goodbye': 'au revoir',
                            'thank you': 'merci',
                            'please': 's\'il vous plaît',
                            'yes': 'oui',
                            'no': 'non',
                            'how are you': 'comment allez-vous',
                            'good morning': 'bonjour'
                        },
                        'en-de': {
                            'hello': 'hallo',
                            'goodbye': 'auf wiedersehen',
                            'thank you': 'danke',
                            'please': 'bitte',
                            'yes': 'ja',
                            'no': 'nein',
                            'how are you': 'wie geht es dir',
                            'good morning': 'guten morgen'
                        }
                    };
                    this.saveDictionary();
                }
            }
            
            // Save dictionary to localStorage
            saveDictionary() {
                localStorage.setItem('translationDictionary', JSON.stringify(this.dictionary));
            }
            
            // Load settings from localStorage
            loadSettings() {
                const savedSettings = localStorage.getItem('translationSettings');
                if (savedSettings) {
                    this.settings = JSON.parse(savedSettings);
                } else {
                    // Default settings
                    this.settings = {
                        hotkeyEnabled: true,
                        defaultTargetLang: 'es',
                        translationHistorySize: 10
                    };
                    this.saveSettings();
                }
            }
            
            // Save settings to localStorage
            saveSettings() {
                localStorage.setItem('translationSettings', JSON.stringify(this.settings));
            }
            
            // Load history from localStorage
            loadHistory() {
                const savedHistory = localStorage.getItem('translationHistory');
                if (savedHistory) {
                    this.history = JSON.parse(savedHistory);
                }
            }
            
            // Save history to localStorage
            saveHistory() {
                localStorage.setItem('translationHistory', JSON.stringify(this.history));
            }
            
            // Detect language based on common words
            detectLanguage(text) {
                if (!text.trim()) return 'Unknown';
                
                const words = text.toLowerCase().split(/\s+/);
                const langScores = {
                    'en': 0,
                    'es': 0,
                    'fr': 0,
                    'de': 0
                };
                
                // Common words for each language
                const commonWords = {
                    'en': ['the', 'be', 'to', 'of', 'and', 'a', 'in', 'that', 'have', 'i'],
                    'es': ['el', 'la', 'de', 'que', 'y', 'a', 'en', 'un', 'por', 'con'],
                    'fr': ['le', 'la', 'de', 'et', 'à', 'en', 'un', 'que', 'pour', 'dans'],
                    'de': ['der', 'die', 'das', 'und', 'in', 'den', 'von', 'zu', 'für', 'mit']
                };
                
                // Score each language
                for (const lang in commonWords) {
                    commonWords[lang].forEach(word => {
                        if (words.includes(word)) {
                            langScores[lang] += 1;
                        }
                    });
                }
                
                // Find language with highest score
                let maxScore = 0;
                let detectedLang = 'Unknown';
                
                for (const lang in langScores) {
                    if (langScores[lang] > maxScore) {
                        maxScore = langScores[lang];
                        detectedLang = lang;
                    }
                }
                
                // Return language name
                const langNames = {
                    'en': 'English',
                    'es': 'Spanish',
                    'fr': 'French',
                    'de': 'German'
                };
                
                return langNames[detectedLang] || 'Unknown';
            }
            
            // Translate text using dictionary
            translate(text, targetLang) {
                if (!text.trim()) return '';
                
                const sourceLang = 'en'; // Our dictionary is based on English as source
                const langPair = `${sourceLang}-${targetLang}`;
                const lowerText = text.toLowerCase();
                
                // First try to find exact matches in dictionary
                if (this.dictionary[langPair] && this.dictionary[langPair][lowerText]) {
                    return this.dictionary[langPair][lowerText];
                }
                
                // Try to translate phrases (longest first)
                const phrases = Object.keys(this.dictionary[langPair] || {})
                    .filter(phrase => phrase.includes(' ') && lowerText.includes(phrase))
                    .sort((a, b) => b.length - a.length);
                
                let result = text;
                
                for (const phrase of phrases) {
                    const regex = new RegExp(phrase, 'gi');
                    result = result.replace(regex, this.dictionary[langPair][phrase]);
                }
                
                // Translate word by word for remaining words
                const words = result.split(' ');
                const translatedWords = words.map(word => {
                    const lowerWord = word.toLowerCase();
                    
                    // Check if word exists in dictionary
                    if (this.dictionary[langPair] && this.dictionary[langPair][lowerWord]) {
                        return this.dictionary[langPair][lowerWord];
                    }
                    
                    // If no translation found, return original word
                    return word;
                });
                
                return translatedWords.join(' ');
            }
            
            // Add to dictionary
            addToDictionary(source, translation, langPair) {
                if (!source.trim() || !translation.trim()) return false;
                
                if (!this.dictionary[langPair]) {
                    this.dictionary[langPair] = {};
                }
                
                this.dictionary[langPair][source.toLowerCase()] = translation;
                this.saveDictionary();
                return true;
            }
            
            // Remove from dictionary
            removeFromDictionary(source, langPair) {
                if (!this.dictionary[langPair] || !this.dictionary[langPair][source]) return false;
                
                delete this.dictionary[langPair][source];
                this.saveDictionary();
                return true;
            }
            
            // Get dictionary entries
            getDictionaryEntries(langPair) {
                if (!this.dictionary[langPair]) return [];
                
                return Object.entries(this.dictionary[langPair]).map(([source, translation]) => ({
                    source,
                    translation
                }));
            }
            
            // Get dictionary size
            getDictionarySize() {
                let count = 0;
                for (const langPair in this.dictionary) {
                    count += Object.keys(this.dictionary[langPair]).length;
                }
                return count;
            }
            
            // Add to history
            addToHistory(source, translation, sourceLang, targetLang) {
                this.history.unshift({
                    source,
                    translation,
                    sourceLang,
                    targetLang,
                    timestamp: new Date().toISOString()
                });
                
                // Limit history size
                if (this.settings.translationHistorySize > 0 && 
                    this.history.length > this.settings.translationHistorySize) {
                    this.history.pop();
                }
                
                this.saveHistory();
            }
            
            // Clear history
            clearHistory() {
                this.history = [];
                this.saveHistory();
            }
            
            // Get filtered history
            getFilteredHistory(filter = 'all') {
                if (filter === 'all') return this.history;
                
                return this.history.filter(item => {
                    const langPair = `en-${item.targetLang}`;
                    return langPair === filter;
                });
            }
            
            // Get suggestions for text
            getSuggestions(text, targetLang) {
                if (!text.trim()) return [];
                
                const langPair = `en-${targetLang}`;
                const lowerText = text.toLowerCase();
                const suggestions = [];
                
                if (!this.dictionary[langPair]) return suggestions;
                
                // Find words that start with the input
                for (const [source, translation] of Object.entries(this.dictionary[langPair])) {
                    if (source.startsWith(lowerText)) {
                        suggestions.push({ source, translation });
                    }
                }
                
                return suggestions.slice(0, 5); // Return top 5 suggestions
            }
        }

        // UI Controller
        class TranslationUI {
            constructor() {
                this.engine = new TranslationEngine();
                this.initElements();
                this.initEventListeners();
                this.initApp();
            }
            
            initElements() {
                this.elements = {
                    sourceText: document.getElementById('source-text'),
                    sourceLang: document.getElementById('source-lang'),
                    translateBtn: document.getElementById('translate-btn'),
                    translationResult: document.getElementById('translation-result'),
                    translationInfo: document.getElementById('translation-info'),
                    copyBtn: document.querySelector('.copy-btn'),
                    charCount: document.querySelector('.char-count'),
                    
                    // Dictionary elements
                    sourceWord: document.getElementById('source-word'),
                    targetWord: document.getElementById('target-word'),
                    dictionaryLang: document.getElementById('dictionary-lang'),
                    addWordBtn: document.getElementById('add-word-btn'),
                    dictionaryMessage: document.getElementById('dictionary-message'),
                    dictionaryEntries: document.getElementById('dictionary-entries'),
                    dictionarySuggestions: document.getElementById('dictionary-suggestions'),
                    
                    // Settings elements
                    enableHotkey: document.getElementById('enable-hotkey'),
                    defaultLang: document.getElementById('default-lang'),
                    translationHistory: document.getElementById('translation-history'),
                    saveSettings: document.getElementById('save-settings'),
                    resetDictionary: document.getElementById('reset-dictionary'),
                    exportData: document.getElementById('export-data'),
                    importData: document.getElementById('import-data'),
                    settingsMessage: document.getElementById('settings-message'),
                    dictSize: document.getElementById('dict-size'),
                    
                    // History elements
                    historyFilter: document.getElementById('history-filter'),
                    historyList: document.getElementById('history-list'),
                    clearHistory: document.getElementById('clear-history'),
                    
                    // Tabs
                    tabs: document.querySelectorAll('.tab'),
                    tabContents: document.querySelectorAll('.tab-content'),
                    
                    // Language options
                    langOptions: document.querySelectorAll('.lang-option')
                };
            }
            
            initEventListeners() {
                // Translation events
                this.elements.translateBtn.addEventListener('click', () => this.translateText());
                this.elements.sourceText.addEventListener('input', () => {
                    this.detectLanguage();
                    this.updateCharCount();
                });
                this.elements.copyBtn.addEventListener('click', () => this.copyTranslation());
                
                // Dictionary events
                this.elements.addWordBtn.addEventListener('click', () => this.addWordToDictionary());
                this.elements.dictionaryLang.addEventListener('change', () => this.renderDictionary());
                
                // Settings events
                this.elements.saveSettings.addEventListener('click', () => this.saveSettings());
                this.elements.resetDictionary.addEventListener('click', () => this.resetDictionary());
                this.elements.exportData.addEventListener('click', () => this.exportData());
                this.elements.importData.addEventListener('click', () => this.importData());
                
                // History events
                this.elements.historyFilter.addEventListener('change', () => this.renderHistory());
                this.elements.clearHistory.addEventListener('click', () => this.clearHistory());
                
                // Tab switching
                this.elements.tabs.forEach(tab => {
                    tab.addEventListener('click', () => this.switchTab(tab.dataset.tab));
                });
                
                // Language options
                this.elements.langOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        this.elements.langOptions.forEach(opt => opt.classList.remove('active'));
                        option.classList.add('active');
                    });
                });
            }
            
            initApp() {
                this.updateCharCount();
                this.renderDictionary();
                this.renderHistory();
                this.detectLanguage();
                this.updateSettingsUI();
                this.updateDictSize();
                
                // Load selected text from page if available
                this.loadSelectedText();
            }
            
            loadSelectedText() {
                // This would be implemented differently in a real extension
                // For this demo, we'll simulate it
                const urlParams = new URLSearchParams(window.location.search);
                const selectedText = urlParams.get('text');
                
                if (selectedText) {
                    this.elements.sourceText.value = selectedText;
                    this.detectLanguage();
                }
            }
            
            updateCharCount() {
                const text = this.elements.sourceText.value;
                this.elements.charCount.textContent = `${text.length}/500`;
            }
            
            switchTab(tabName) {
                // Update active tab
                this.elements.tabs.forEach(tab => {
                    if (tab.dataset.tab === tabName) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });
                
                // Show active tab content
                this.elements.tabContents.forEach(content => {
                    if (content.id === `${tabName}-tab`) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });
                
                // Refresh data if needed
                if (tabName === 'dictionary') {
                    this.renderDictionary();
                } else if (tabName === 'history') {
                    this.renderHistory();
                } else if (tabName === 'settings') {
                    this.updateSettingsUI();
                    this.updateDictSize();
                }
            }
            
            detectLanguage() {
                const text = this.elements.sourceText.value;
                if (!text.trim()) {
                    this.elements.sourceLang.value = '';
                    return;
                }
                
                const detected = this.engine.detectLanguage(text);
                this.elements.sourceLang.value = detected;
                
                // Get suggestions
                const activeLang = document.querySelector('.lang-option.active').dataset.lang;
                this.showSuggestions(text, activeLang);
            }
            
            showSuggestions(text, targetLang) {
                const suggestions = this.engine.getSuggestions(text, targetLang);
                this.elements.dictionarySuggestions.innerHTML = '';
                
                if (suggestions.length === 0) return;
                
                const suggestionsHTML = suggestions.map(suggestion => {
                    return `<div class="dictionary-item">
                        <div>
                            <strong>${suggestion.source}</strong> → ${suggestion.translation}
                        </div>
                    </div>`;
                }).join('');
                
                this.elements.dictionarySuggestions.innerHTML = suggestionsHTML;
            }
            
            translateText() {
                const text = this.elements.sourceText.value;
                const targetLang = document.querySelector('.lang-option.active').dataset.lang;
                
                if (!text.trim()) {
                    // this.showMessage(this.elements.translationResult, 'Please enter text to translate', true);
                    return;
                }
                
                const detectedLang = this.engine.detectLanguage(text);
                const translation = this.engine.translate(text, targetLang);
                
                this.elements.translationResult.textContent = translation;
                this.elements.translationInfo.textContent = `Detected as ${detectedLang}, translated to ${this.getLangName(targetLang)}`;
                
                // Add to history
                this.engine.addToHistory(text, translation, detectedLang, this.getLangName(targetLang));
            }
            
            getLangName(langCode) {
                const langNames = {
                    'es': 'Spanish',
                    'fr': 'French',
                    'de': 'German'
                };
                return langNames[langCode] || langCode;
            }
            
            copyTranslation() {
                const text = this.elements.translationResult.textContent;
                if (!text) return;
                
                navigator.clipboard.writeText(text)
                    .then(() => {
                        const btn = this.elements.copyBtn;
                        const originalText = btn.textContent;
                        btn.textContent = '✅ Copied!';
                        setTimeout(() => {
                            btn.textContent = originalText;
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Failed to copy: ', err);
                    });
            }
            
            addWordToDictionary() {
                const source = this.elements.sourceWord.value.trim();
                const translation = this.elements.targetWord.value.trim();
                const langPair = this.elements.dictionaryLang.value;
                
                if (!source || !translation) {
                    this.showDictionaryMessage('Please enter both source and translation', true);
                    return;
                }
                
                const success = this.engine.addToDictionary(source, translation, langPair);
                if (success) {
                    this.showDictionaryMessage('Word added to dictionary successfully!');
                    this.elements.sourceWord.value = '';
                    this.elements.targetWord.value = '';
                    this.renderDictionary();
                    this.updateDictSize();
                } else {
                    this.showDictionaryMessage('Failed to add word to dictionary', true);
                }
            }
            
            showDictionaryMessage(message, isError = false) {
                this.elements.dictionaryMessage.textContent = message;
                this.elements.dictionaryMessage.className = 'message';
                this.elements.dictionaryMessage.classList.add(isError ? 'error' : 'success');
                this.elements.dictionaryMessage.classList.remove('hidden');
                
                setTimeout(() => {
                    this.elements.dictionaryMessage.classList.add('hidden');
                }, 3000);
            }
            
            renderDictionary() {
                const langPair = this.elements.dictionaryLang.value;
                const entries = this.engine.getDictionaryEntries(langPair);
                
                if (entries.length === 0) {
                    this.elements.dictionaryEntries.innerHTML = '<div class="dictionary-empty">No entries found for this language pair</div>';
                    return;
                }
                
                this.elements.dictionaryEntries.innerHTML = '';
                
                entries.forEach(entry => {
                    const entryElement = document.createElement('div');
                    entryElement.className = 'dictionary-item';
                    entryElement.innerHTML = `
                        <div>
                            <strong>${entry.source}</strong> → ${entry.translation}
                        </div>
                        <button class="remove-entry" data-source="${entry.source}" data-lang="${langPair}">Remove</button>
                    `;
                    this.elements.dictionaryEntries.appendChild(entryElement);
                });
                
                // Add event listeners to remove buttons
                document.querySelectorAll('.remove-entry').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const source = e.target.dataset.source;
                        const langPair = e.target.dataset.lang;
                        this.removeDictionaryEntry(source, langPair);
                    });
                });
            }
            
            removeDictionaryEntry(source, langPair) {
                if (confirm(`Are you sure you want to remove "${source}" from your dictionary?`)) {
                    const success = this.engine.removeFromDictionary(source, langPair);
                    if (success) {
                        this.showDictionaryMessage('Word removed from dictionary');
                        this.renderDictionary();
                        this.updateDictSize();
                    } else {
                        this.showDictionaryMessage('Failed to remove word', true);
                    }
                }
            }
            
            updateSettingsUI() {
                this.elements.enableHotkey.value = this.engine.settings.hotkeyEnabled.toString();
                this.elements.defaultLang.value = this.engine.settings.defaultTargetLang;
                this.elements.translationHistory.value = this.engine.settings.translationHistorySize.toString();
            }
            
            saveSettings() {
                this.engine.settings = {
                    hotkeyEnabled: this.elements.enableHotkey.value === 'true',
                    defaultTargetLang: this.elements.defaultLang.value,
                    translationHistorySize: parseInt(this.elements.translationHistory.value)
                };
                
                this.engine.saveSettings();
                this.showSettingsMessage('Settings saved successfully!');
            }
            
            showSettingsMessage(message, isError = false) {
                this.elements.settingsMessage.textContent = message;
                this.elements.settingsMessage.className = 'message';
                this.elements.settingsMessage.classList.add(isError ? 'error' : 'success');
                this.elements.settingsMessage.classList.remove('hidden');
                
                setTimeout(() => {
                    this.elements.settingsMessage.classList.add('hidden');
                }, 3000);
            }
            
            resetDictionary() {
                if (confirm('Are you sure you want to reset your dictionary? This action cannot be undone.')) {
                    localStorage.removeItem('translationDictionary');
                    this.engine.loadDictionary();
                    this.renderDictionary();
                    this.updateDictSize();
                    this.showSettingsMessage('Dictionary has been reset');
                }
            }
            
            updateDictSize() {
                this.elements.dictSize.textContent = this.engine.getDictionarySize();
            }
            
            exportData() {
                const data = {
                    dictionary: this.engine.dictionary,
                    settings: this.engine.settings
                };
                
                const dataStr = JSON.stringify(data);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = 'localtranslate-data.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            }
            
            importData() {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.json';
                
                fileInput.onchange = e => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = event => {
                        try {
                            const data = JSON.parse(event.target.result);
                            
                            if (data.dictionary && data.settings) {
                                localStorage.setItem('translationDictionary', JSON.stringify(data.dictionary));
                                localStorage.setItem('translationSettings', JSON.stringify(data.settings));
                                
                                // Reload engine with new data
                                this.engine = new TranslationEngine();
                                this.renderDictionary();
                                this.updateSettingsUI();
                                this.updateDictSize();
                                this.showSettingsMessage('Data imported successfully!');
                            } else {
                                this.showSettingsMessage('Invalid data format', true);
                            }
                        } catch (error) {
                            this.showSettingsMessage('Error parsing file: ' + error.message, true);
                        }
                    };
                    
                    reader.readAsText(file);
                };
                
                fileInput.click();
            }
            
            renderHistory() {
                const filter = this.elements.historyFilter.value;
                const historyItems = this.engine.getFilteredHistory(filter);
                
                if (historyItems.length === 0) {
                    this.elements.historyList.innerHTML = '<div class="dictionary-empty">No translation history found</div>';
                    return;
                }
                
                this.elements.historyList.innerHTML = '';
                
                historyItems.forEach(item => {
                    const historyElement = document.createElement('div');
                    historyElement.className = 'history-item';
                    historyElement.innerHTML = `
                        <div class="history-text">
                            <span>${item.source}</span>
                            <small>${new Date(item.timestamp).toLocaleString()}</small>
                        </div>
                        <div class="history-translation">${item.translation}</div>
                    `;
                    
                    historyElement.addEventListener('click', () => {
                        this.switchTab('translate');
                        this.elements.sourceText.value = item.source;
                        this.detectLanguage();
                        
                        // Set target language
                        const targetLang = item.targetLang.toLowerCase().slice(0, 2);
                        this.elements.langOptions.forEach(option => {
                            option.classList.toggle('active', option.dataset.lang === targetLang);
                        });
                        
                        // Trigger translation
                        setTimeout(() => this.translateText(), 100);
                    });
                    
                    this.elements.historyList.appendChild(historyElement);
                });
            }
            
            clearHistory() {
                if (confirm('Are you sure you want to clear your translation history?')) {
                    this.engine.clearHistory();
                    this.renderHistory();
                    this.showSettingsMessage('Translation history cleared');
                }
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            const translationUI = new TranslationUI();
        });
    </script>
</body>
</html>